{% extends 'base.html' %}

{% block content %}
<div class="container-fluid my-4">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-lg-3">
            <div class="card sticky-top" style="top: 20px; z-index: 10;">
                <div class="card-header">
                    <h3 class="card-title-primary mb-0">{{ resume.title }}</h3>
                </div>
                <div class="card-body p-0">
                    <div class="list-group list-group-flush resume-nav">
                        <a href="#basics" class="list-group-item list-group-item-action bg-transparent">
                            <i class="fas fa-user me-2"></i> Basic Information
                        </a>
                        <a href="#experience" class="list-group-item list-group-item-action bg-transparent">
                            <i class="fas fa-briefcase me-2"></i> Experience
                        </a>
                        <a href="#education" class="list-group-item list-group-item-action bg-transparent">
                            <i class="fas fa-graduation-cap me-2"></i> Education
                        </a>
                        <a href="#skills" class="list-group-item list-group-item-action bg-transparent">
                            <i class="fas fa-tools me-2"></i> Skills
                        </a>
                        <a href="#projects" class="list-group-item list-group-item-action bg-transparent">
                            <i class="fas fa-project-diagram me-2"></i> Projects
                        </a>
                        <a href="#design" class="list-group-item list-group-item-action bg-transparent">
                            <i class="fas fa-palette me-2"></i> Design Settings
                        </a>
                    </div>
                    
                    <div class="p-3 border-top">
                        <div class="d-grid gap-2">
                            <a href="{{ url_for('resume.view', resume_id=resume.id) }}" class="btn btn-primary" target="_blank">
                                <i class="fas fa-eye me-2"></i> Preview Resume
                            </a>
                            <a href="{{ url_for('resume.analyze', resume_id=resume.id) }}" class="btn btn-info text-white">
                                <i class="fas fa-chart-line me-2"></i> Analyze with ATS
                            </a>
                            <a href="{{ url_for('resume.export', resume_id=resume.id) }}" class="btn btn-outline-primary">
                                <i class="fas fa-file-pdf me-2"></i> Export as PDF
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Main content -->
        <div class="col-lg-9">
            <!-- Basic Information Section -->
            <div class="card mb-4" id="basics">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h3 class="mb-0"><i class="fas fa-user me-2"></i> Basic Information</h3>
                    <button type="button" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#editBasicsModal">
                        <i class="fas fa-edit me-1"></i> Edit
                    </button>
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-md-3 text-muted">Resume Title:</div>
                        <div class="col-md-9">{{ resume.title }}</div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-3 text-muted">Template:</div>
                        <div class="col-md-9">{{ resume.template|capitalize }}</div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-3 text-muted">Contact Information:</div>
                        <div class="col-md-9">
                            {{ current_user.first_name }} {{ current_user.last_name }}<br>
                            {{ current_user.email }}
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-3 text-muted">Career Objective:</div>
                        <div class="col-md-9">
                            {% if resume.objective %}
                                {{ resume.objective }}
                            {% else %}
                                <span class="text-muted fst-italic">No objective/summary added yet.</span>
                                <div class="mt-2">
                                    <form action="{{ url_for('resume.generate_summary', resume_id=resume.id) }}" method="POST">
                                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                        <button type="submit" class="btn btn-sm btn-outline-primary">
                                            <i class="fas fa-magic me-1"></i> Generate AI Summary
                                        </button>
                                    </form>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Experience Section -->
            <div class="card mb-4" id="experience">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h3 class="mb-0"><i class="fas fa-briefcase me-2"></i> Experience</h3>
                    <a href="{{ url_for('resume.add_section', resume_id=resume.id) }}?type=experience" class="btn btn-sm btn-primary">
                        <i class="fas fa-plus me-1"></i> Add Experience
                    </a>
                </div>
                <div class="card-body">
                    {% set experience_sections = section_types.get('experience', []) %}
                    {% if experience_sections %}
                        {% for section in experience_sections %}
                            <div class="card mb-3 section-card" data-section-id="{{ section.id }}">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <h4 class="mb-1">{{ section.title }}</h4>
                                        <div>
                                            <button class="btn btn-sm btn-outline-secondary me-1 edit-section-btn" data-section-id="{{ section.id }}">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn btn-sm btn-outline-danger delete-section-btn" data-section-id="{{ section.id }}">
                                                <i class="fas fa-trash-alt"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <h5 class="text-muted">{{ section.organization }}</h5>
                                    <div class="mb-2 small text-muted">
                                        {% if section.start_date %}
                                            {{ section.start_date.strftime('%b %Y') }} - 
                                            {% if section.is_current %}
                                                Present
                                            {% elif section.end_date %}
                                                {{ section.end_date.strftime('%b %Y') }}
                                            {% endif %}
                                        {% endif %}
                                        {% if section.location %}
                                            <span class="ms-2"><i class="fas fa-map-marker-alt me-1"></i> {{ section.location }}</span>
                                        {% endif %}
                                    </div>
                                    
                                    {% if section.description %}
                                        <p>{{ section.description }}</p>
                                    {% endif %}
                                    
                                    {% if section.bullets %}
                                        <ul class="mb-0">
                                            {% for bullet in section.bullets %}
                                                <li class="bullet-item" data-bullet-id="{{ bullet.id }}">
                                                    <div class="d-flex align-items-start">
                                                        <div class="flex-grow-1">{{ bullet.content }}</div>
                                                        <div class="ms-2">
                                                            <button class="btn btn-sm btn-link p-0 enhance-bullet-btn" data-bullet-id="{{ bullet.id }}" title="AI Enhance">
                                                                <i class="fas fa-magic text-primary"></i>
                                                            </button>
                                                            <button class="btn btn-sm btn-link p-0 ms-1 delete-bullet-btn" data-bullet-id="{{ bullet.id }}" title="Delete">
                                                                <i class="fas fa-times text-danger"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </li>
                                            {% endfor %}
                                        </ul>
                                    {% endif %}
                                    
                                    <div class="mt-3">
                                        <button class="btn btn-sm btn-outline-info suggest-bullets-btn" data-section-id="{{ section.id }}">
                                            <i class="fas fa-lightbulb me-1"></i> AI Suggest Bullet Points
                                        </button>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="text-center py-4">
                            <div class="mb-3">
                                <i class="fas fa-briefcase fa-3x text-muted"></i>
                            </div>
                            <p>No work experience added yet.</p>
                            <a href="{{ url_for('resume.add_section', resume_id=resume.id) }}?type=experience" class="btn btn-primary">
                                <i class="fas fa-plus me-1"></i> Add Experience
                            </a>
                            <button class="btn btn-outline-info ms-2" id="importLinkedInBtn">
                                <i class="fab fa-linkedin me-1"></i> Import from LinkedIn
                            </button>
                        </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Education Section -->
            <div class="card mb-4" id="education">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h3 class="mb-0"><i class="fas fa-graduation-cap me-2"></i> Education</h3>
                    <a href="{{ url_for('resume.add_section', resume_id=resume.id) }}?type=education" class="btn btn-sm btn-primary">
                        <i class="fas fa-plus me-1"></i> Add Education
                    </a>
                </div>
                <div class="card-body">
                    {% set education_sections = section_types.get('education', []) %}
                    {% if education_sections %}
                        {% for section in education_sections %}
                            <div class="card mb-3 section-card" data-section-id="{{ section.id }}">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <h4 class="mb-1">{{ section.title }}</h4>
                                        <div>
                                            <button class="btn btn-sm btn-outline-secondary me-1 edit-section-btn" data-section-id="{{ section.id }}">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn btn-sm btn-outline-danger delete-section-btn" data-section-id="{{ section.id }}">
                                                <i class="fas fa-trash-alt"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <h5 class="text-muted">{{ section.organization }}</h5>
                                    <div class="mb-2 small text-muted">
                                        {% if section.start_date %}
                                            {{ section.start_date.strftime('%b %Y') }} - 
                                            {% if section.is_current %}
                                                Present
                                            {% elif section.end_date %}
                                                {{ section.end_date.strftime('%b %Y') }}
                                            {% endif %}
                                        {% endif %}
                                        {% if section.location %}
                                            <span class="ms-2"><i class="fas fa-map-marker-alt me-1"></i> {{ section.location }}</span>
                                        {% endif %}
                                    </div>
                                    
                                    {% if section.description %}
                                        <p>{{ section.description }}</p>
                                    {% endif %}
                                    
                                    {% if section.bullets %}
                                        <ul class="mb-0">
                                            {% for bullet in section.bullets %}
                                                <li class="bullet-item" data-bullet-id="{{ bullet.id }}">
                                                    <div class="d-flex align-items-start">
                                                        <div class="flex-grow-1">{{ bullet.content }}</div>
                                                        <div class="ms-2">
                                                            <button class="btn btn-sm btn-link p-0 enhance-bullet-btn" data-bullet-id="{{ bullet.id }}" title="AI Enhance">
                                                                <i class="fas fa-magic text-primary"></i>
                                                            </button>
                                                            <button class="btn btn-sm btn-link p-0 ms-1 delete-bullet-btn" data-bullet-id="{{ bullet.id }}" title="Delete">
                                                                <i class="fas fa-times text-danger"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </li>
                                            {% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="text-center py-4">
                            <div class="mb-3">
                                <i class="fas fa-graduation-cap fa-3x text-muted"></i>
                            </div>
                            <p>No education added yet.</p>
                            <a href="{{ url_for('resume.add_section', resume_id=resume.id) }}?type=education" class="btn btn-primary">
                                <i class="fas fa-plus me-1"></i> Add Education
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Skills Section -->
            <div class="card mb-4" id="skills">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h3 class="mb-0"><i class="fas fa-tools me-2"></i> Skills</h3>
                    <a href="{{ url_for('resume.add_skill', resume_id=resume.id) }}" class="btn btn-sm btn-primary">
                        <i class="fas fa-plus me-1"></i> Add Skill
                    </a>
                </div>
                <div class="card-body">
                    {% if skill_categories %}
                        {% for category, skills in skill_categories.items() %}
                            <h4 class="mt-3 mb-2">{{ category }}</h4>
                            <div class="row">
                                {% for skill in skills %}
                                    <div class="col-md-6 mb-3">
                                        <div class="card h-100">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between align-items-start">
                                                    <h5 class="card-title mb-1">{{ skill.skill_name }}</h5>
                                                    <button class="btn btn-sm btn-outline-danger delete-skill-btn" data-skill-id="{{ skill.id }}">
                                                        <i class="fas fa-times"></i>
                                                    </button>
                                                </div>
                                                <div class="progress mt-2" style="height: 10px;">
                                                    <div class="progress-bar" role="progressbar" style="width: {{ skill.proficiency * 20 }}%;" 
                                                        aria-valuenow="{{ skill.proficiency }}" aria-valuemin="0" aria-valuemax="5"></div>
                                                </div>
                                                <div class="d-flex justify-content-between mt-1">
                                                    <small>Beginner</small>
                                                    <small>Expert</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="text-center py-4">
                            <div class="mb-3">
                                <i class="fas fa-tools fa-3x text-muted"></i>
                            </div>
                            <p>No skills added yet.</p>
                            <a href="{{ url_for('resume.add_skill', resume_id=resume.id) }}" class="btn btn-primary">
                                <i class="fas fa-plus me-1"></i> Add Skills
                            </a>
                            <button class="btn btn-outline-info ms-2" id="scanProfileBtn">
                                <i class="fas fa-magic me-1"></i> Scan Profile for Skills
                            </button>
                        </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Design Settings Section -->
            <div class="card mb-4" id="design">
                <div class="card-header">
                    <h3 class="mb-0"><i class="fas fa-palette me-2"></i> Design Settings</h3>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('resume.edit', resume_id=resume.id) }}">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label class="form-label">Template</label>
                                <div class="d-flex flex-wrap gap-2">
                                    <div class="form-check form-check-inline template-option">
                                        <input class="form-check-input" type="radio" name="template" id="templateModern" value="modern" {% if resume.template == 'modern' %}checked{% endif %}>
                                        <label class="form-check-label" for="templateModern">
                                            <div class="template-preview">
                                                <img src="{{ url_for('static', filename='img/templates/modern_thumb.png') }}" alt="Modern Template">
                                            </div>
                                            Modern
                                        </label>
                                    </div>
                                    <div class="form-check form-check-inline template-option">
                                        <input class="form-check-input" type="radio" name="template" id="templateProfessional" value="professional" {% if resume.template == 'professional' %}checked{% endif %}>
                                        <label class="form-check-label" for="templateProfessional">
                                            <div class="template-preview">
                                                <img src="{{ url_for('static', filename='img/templates/professional_thumb.png') }}" alt="Professional Template">
                                            </div>
                                            Professional
                                        </label>
                                    </div>
                                    <div class="form-check form-check-inline template-option">
                                        <input class="form-check-input" type="radio" name="template" id="templateCreative" value="creative" {% if resume.template == 'creative' %}checked{% endif %}>
                                        <label class="form-check-label" for="templateCreative">
                                            <div class="template-preview">
                                                <img src="{{ url_for('static', filename='img/templates/creative_thumb.png') }}" alt="Creative Template">
                                            </div>
                                            Creative
                                        </label>
                                    </div>
                                </div>
                                <div class="form-text">
                                    <a href="{{ url_for('resume.templates') }}" target="_blank">View all templates</a>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <label class="form-label">Color Scheme</label>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Primary Color</label>
                                        <input type="color" class="form-control form-control-color w-100" name="primary_color" value="{{ resume.primary_color }}" title="Choose primary color">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Secondary Color</label>
                                        <input type="color" class="form-control form-control-color w-100" name="secondary_color" value="{{ resume.secondary_color }}" title="Choose secondary color">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label class="form-label">Font Family</label>
                                <select class="form-select" name="font_family">
                                    <option value="Roboto" {% if resume.font_family == 'Roboto' %}selected{% endif %}>Roboto</option>
                                    <option value="Open Sans" {% if resume.font_family == 'Open Sans' %}selected{% endif %}>Open Sans</option>
                                    <option value="Lato" {% if resume.font_family == 'Lato' %}selected{% endif %}>Lato</option>
                                    <option value="Montserrat" {% if resume.font_family == 'Montserrat' %}selected{% endif %}>Montserrat</option>
                                    <option value="Raleway" {% if resume.font_family == 'Raleway' %}selected{% endif %}>Raleway</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-1"></i> Save Design Settings
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Edit Basics Modal -->
<div class="modal fade" id="editBasicsModal" tabindex="-1" aria-labelledby="editBasicsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editBasicsModalLabel">Edit Basic Information</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="POST" action="{{ url_for('resume.edit', resume_id=resume.id) }}">
                <div class="modal-body">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <div class="mb-3">
                        <label for="title" class="form-label">Resume Title</label>
                        <input type="text" class="form-control" id="title" name="title" value="{{ resume.title }}" required>
                        <div class="form-text">This is for your reference only and won't appear on the resume.</div>
                    </div>
                    <div class="mb-3">
                        <label for="objective" class="form-label">Career Objective/Summary</label>
                        <textarea class="form-control" id="objective" name="objective" rows="4">{{ resume.objective }}</textarea>
                        <div class="form-text">A brief summary of your career goals and qualifications.</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- AI Enhance Bullet Modal -->
<div class="modal fade" id="enhanceBulletModal" tabindex="-1" aria-labelledby="enhanceBulletModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="enhanceBulletModalLabel">
                    <i class="fas fa-magic me-2 text-primary"></i> AI Enhanced Bullet Point
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">Original</label>
                    <div class="p-3 bg-light rounded" id="originalBullet"></div>
                </div>
                <div class="mb-3">
                    <label class="form-label">AI Enhanced Version</label>
                    <div class="p-3 bg-light rounded border-primary border" id="enhancedBullet"></div>
                    <div class="form-text">
                        <i class="fas fa-info-circle me-1"></i> The AI has improved your bullet point by adding action verbs, 
                        quantifiable achievements, and ensuring clarity.
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label">Edit (Optional)</label>
                    <textarea class="form-control" id="editedBullet" rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="applyEnhancedBulletBtn">Apply Enhancement</button>
            </div>
        </div>
    </div>
</div>

<!-- AI Suggest Bullets Modal -->
<div class="modal fade" id="suggestBulletsModal" tabindex="-1" aria-labelledby="suggestBulletsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="suggestBulletsModalLabel">
                    <i class="fas fa-lightbulb me-2 text-warning"></i> AI Suggested Bullet Points
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Based on your experience, here are some suggested bullet points you can add:</p>
                <div id="suggestedBulletsList" class="mt-3"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Smooth scrolling for sidebar navigation
    document.querySelectorAll('.resume-nav a').forEach(anchor => {
        anchor.addEventListener('click', function(e) {
            e.preventDefault();
            const targetId = this.getAttribute('href');
            const targetElement = document.querySelector(targetId);
            
            if (targetElement) {
                window.scrollTo({
                    top: targetElement.offsetTop - 20,
                    behavior: 'smooth'
                });
                
                // Update active state
                document.querySelectorAll('.resume-nav a').forEach(a => a.classList.remove('active'));
                this.classList.add('active');
            }
        });
    });
    
    // Delete section button
    document.querySelectorAll('.delete-section-btn').forEach(button => {
        button.addEventListener('click', function() {
            if (confirm('Are you sure you want to delete this section? This cannot be undone.')) {
                const sectionId = this.getAttribute('data-section-id');
                
                fetch(`/resume/api/section/${sectionId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token() }}'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const sectionCard = document.querySelector(`.section-card[data-section-id="${sectionId}"]`);
                        sectionCard.remove();
                    } else {
                        alert(data.message || 'Error deleting section.');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred. Please try again.');
                });
            }
        });
    });
    
    // Delete bullet button
    document.querySelectorAll('.delete-bullet-btn').forEach(button => {
        button.addEventListener('click', function() {
            if (confirm('Are you sure you want to delete this bullet point?')) {
                const bulletId = this.getAttribute('data-bullet-id');
                
                fetch(`/resume/api/bullet/${bulletId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token() }}'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const bulletItem = document.querySelector(`.bullet-item[data-bullet-id="${bulletId}"]`);
                        bulletItem.remove();
                    } else {
                        alert(data.message || 'Error deleting bullet point.');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred. Please try again.');
                });
            }
        });
    });
    
    // Delete skill button
    document.querySelectorAll('.delete-skill-btn').forEach(button => {
        button.addEventListener('click', function() {
            if (confirm('Are you sure you want to delete this skill?')) {
                const skillId = this.getAttribute('data-skill-id');
                
                fetch(`/resume/api/skill/${skillId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token() }}'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Find the parent card and remove it
                        this.closest('.card').parentElement.remove();
                    } else {
                        alert(data.message || 'Error deleting skill.');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred. Please try again.');
                });
            }
        });
    });
    
    // Enhance bullet button
    let currentBulletId = null;
    const enhanceBulletModal = document.getElementById('enhanceBulletModal');
    if (enhanceBulletModal) {
        // Handle enhance button click
        document.querySelectorAll('.enhance-bullet-btn').forEach(button => {
            button.addEventListener('click', function() {
                const bulletId = this.getAttribute('data-bullet-id');
                currentBulletId = bulletId;
                
                // Get the current bullet content
                const bulletItem = document.querySelector(`.bullet-item[data-bullet-id="${bulletId}"] .flex-grow-1`);
                const bulletContent = bulletItem.textContent.trim();
                
                // Show the modal with loading state
                document.getElementById('originalBullet').textContent = bulletContent;
                document.getElementById('enhancedBullet').innerHTML = '<div class="d-flex justify-content-center"><div class="spinner-border text-primary" role="status"></div></div>';
                document.getElementById('editedBullet').value = '';
                
                const modal = new bootstrap.Modal(enhanceBulletModal);
                modal.show();
                
                // Call the API to enhance the bullet
                fetch(`/resume/api/bullet/${bulletId}/enhance`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token() }}'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById('enhancedBullet').textContent = data.enhanced;
                        document.getElementById('editedBullet').value = data.enhanced;
                    } else {
                        document.getElementById('enhancedBullet').textContent = 'Failed to enhance bullet point.';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('enhancedBullet').textContent = 'An error occurred. Please try again.';
                });
            });
        });
        
        // Handle apply enhancement button
        document.getElementById('applyEnhancedBulletBtn').addEventListener('click', function() {
            if (!currentBulletId) return;
            
            const editedContent = document.getElementById('editedBullet').value.trim();
            if (!editedContent) return;
            
            // Update the bullet point in the UI
            const bulletItem = document.querySelector(`.bullet-item[data-bullet-id="${currentBulletId}"] .flex-grow-1`);
            bulletItem.textContent = editedContent;
            
            // Close the modal
            bootstrap.Modal.getInstance(enhanceBulletModal).hide();
            
            // TODO: Add API call to save the updated bullet point
            // This would be implemented in a real application
        });
    }
    
    // Suggest bullets button
    const suggestBulletsModal = document.getElementById('suggestBulletsModal');
    if (suggestBulletsModal) {
        document.querySelectorAll('.suggest-bullets-btn').forEach(button => {
            button.addEventListener('click', function() {
                const sectionId = this.getAttribute('data-section-id');
                
                // Show the modal with loading state
                document.getElementById('suggestedBulletsList').innerHTML = `
                    <div class="d-flex justify-content-center p-4">
                        <div class="spinner-border text-primary" role="status"></div>
                    </div>
                `;
                
                const modal = new bootstrap.Modal(suggestBulletsModal);
                modal.show();
                
                // Call the API to get suggestions
                fetch(`/resume/api/section/${sectionId}/suggest-bullets`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token() }}'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.suggestions.length > 0) {
                        let html = '<ul class="list-group">';
                        data.suggestions.forEach((suggestion, index) => {
                            html += `
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <span>${suggestion}</span>
                                    <button class="btn btn-sm btn-outline-primary add-suggestion-btn" data-section-id="${sectionId}" data-suggestion-index="${index}">
                                        <i class="fas fa-plus"></i> Add
                                    </button>
                                </li>
                            `;
                        });
                        html += '</ul>';
                        document.getElementById('suggestedBulletsList').innerHTML = html;
                        
                        // Add event listeners for the Add buttons
                        document.querySelectorAll('.add-suggestion-btn').forEach(btn => {
                            btn.addEventListener('click', function() {
                                const sectionId = this.getAttribute('data-section-id');
                                const suggestionIndex = this.getAttribute('data-suggestion-index');
                                const suggestion = data.suggestions[suggestionIndex];
                                
                                // TODO: Add API call to add the bullet point to the section
                                // This would be implemented in a real application
                                
                                // For now, just update the UI
                                const listItem = this.closest('li');
                                listItem.classList.add('list-group-item-success');
                                this.innerHTML = '<i class="fas fa-check"></i> Added';
                                this.disabled = true;
                                
                                // Refresh the page after a short delay
                                setTimeout(() => {
                                    window.location.reload();
                                }, 1000);
                            });
                        });
                    } else {
                        document.getElementById('suggestedBulletsList').innerHTML = '<p class="text-center">No suggestions available.</p>';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('suggestedBulletsList').innerHTML = '<p class="text-center text-danger">An error occurred. Please try again.</p>';
                });
            });
        });
    }
    
    // LinkedIn Import Button
    document.getElementById('importLinkedInBtn')?.addEventListener('click', function() {
        const resumeId = '{{ resume.id }}';
        
        if (confirm('This will attempt to import your experience from LinkedIn. Continue?')) {
            fetch(`/resume/${resumeId}/import-from-linkedin`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token() }}'
                }
            })
            .then(response => {
                if (response.ok) {
                    alert('LinkedIn data imported successfully!');
                    window.location.reload();
                } else {
                    alert('Failed to import LinkedIn data. Please try again.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred. Please try again.');
            });
        }
    });
    
    // Scan Profile for Skills Button
    document.getElementById('scanProfileBtn')?.addEventListener('click', function() {
        if (confirm('This will scan your profile to automatically detect skills. Continue?')) {
            alert('Feature coming soon: AI skill detection based on your profile and resume content.');
        }
    });
});
</script>
{% endblock %}